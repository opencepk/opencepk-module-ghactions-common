---
   name: test-upload-deploy
   on:
     push:
       branches:
         - '**'
     pull_request:
       types: [opened, synchronize, reopened]
   
   jobs:
     unit-tests:
       runs-on: ubuntu-latest
       steps:
         - name: Checkout repository
           uses: actions/checkout@v4
   
         - name: Set up Node.js
           uses: actions/setup-node@v4
           with:
             node-version: '20.16.0'
   
         - name: Install dependencies
           run: npm install
   
         - name: Run tests with coverage
           run: npm run test:coverage
   
         - name: Upload coverage report
           uses: actions/upload-artifact@v3
           with:
             name: coverage-report
             path: coverage
   
     deploy-coverage:
       needs: unit-tests
       runs-on: ubuntu-latest
       if: github.ref == 'refs/heads/fix/ICE-1010-improvement'
       steps:
         - name: Checkout repository
           uses: actions/checkout@v4
   
         - name: Download coverage report
           uses: actions/download-artifact@v3
           with:
             name: coverage-report
             path: coverage
   
         - name: Configure Git
           run: |
             git config --global user.email "github-actions@github.com"
             git config --global user.name "GitHub Actions"

         - name: Fetch all branches
           run: git fetch --all
   
         - name: Deploy to GitHub Pages
           run: |
             git checkout gh-pages
             git pull origin gh-pages
             cp -r coverage/* .
             git add .
             git commit -m 'Deploy coverage report'
             git push origin gh-pages
           env:
             GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

         - name: Print Coverage Report URL
            run: |
               echo "Coverage report URL: https://${{ github.repository_owner }}.github.io/${{ github.repository }}/coverage/"